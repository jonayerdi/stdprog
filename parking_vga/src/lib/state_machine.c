 /*
                                        *******************
 ***************************************** C SOURCE FILE ****************************************
 **                                     *******************                                    **
 **                                                                                            **
 ** project    : General template                                                              **
 ** filename   : TPL.H                                                                         **
 ** version    : 0.11                                                                          **
 ** date       : 19/11/2015                                                                    **
 **                                                                                            **
 ************************************************************************************************
 **                                                                                            **
 ** Copyright (c) 2015, Sainz Oruna, Markel                                                    **
 ** All rights reserved.                                                                       **
 **                                                                                            **
 ************************************************************************************************

 VERSION HISTORY:
 -- -- -- -- -- --

 Version     : 0.1
 Date        : 19/11/2015
 Revised by  : Sainz Oruna, Markel
 Description : Original version.

 */

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                MODULES USED                                              **/
 /**                                                                                          **/
 /**********************************************************************************************/

 #include "lib/state_machine.h"

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                DEFINITIONS AND MACROS                                    **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                TYPEDEFS AND STRUCTURES                                   **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                PROTOTYPES OF LOCAL FUNCTIONS                             **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                EXPORTED VARIABLES                                        **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                GLOBAL VARIABLES                                          **/
 /**                                                                                          **/
 /**********************************************************************************************/

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                EXPORTED FUNCTIONS                                        **/
 /**                                                                                          **/
 /**********************************************************************************************/

 void STATE_MACHINE_ejecutar(TS_MACHINE *la_maquina)
 {
	if (la_maquina->StopCond != NULL && la_maquina->StopCond(la_maquina->contexto) == TRUE)
		return;

	if (la_maquina->estado_actual < la_maquina->estados_count)
		STATE_MACHINE_ejecuta_estado(la_maquina->estados + la_maquina->estado_actual , la_maquina);
 }

 void STATE_MACHINE_ejecuta_estado(TS_ESTADO *el_estado , TS_MACHINE *la_maquina)
 {
 	el_estado->controles(la_maquina->contexto);

 	for (size_t i = 0; i < el_estado->transiciones_count; i++)
 	{
 		if (el_estado->transiciones[i].evento(la_maquina->contexto) == TRUE)
 		{
 			if (el_estado->transiciones[i].accion != NULL)
 				el_estado->transiciones[i].accion(la_maquina->contexto);
			la_maquina->estado_actual = el_estado->transiciones[i].estado_destino;
			return;

 		}
 	}
 }

 /**********************************************************************************************/
 /**                                                                                          **/
 /**                                LOCAL FUNCTIONS                                           **/
 /**                                                                                          **/
 /**********************************************************************************************/

 //Function prolog

 /********************************************************
 *                                                       *
 * FUNCTION NAME:                                        *
 *                                                       *
 * ARGUMENTS:                                            *
 *                                                       *
 * ARGUMENT TYPE I/O DESCRIPTION                         *
 * -------- ---- --- -----------                         *
 *                                                       *
 * RETURNS:                                              *
 *                                                       *
 *********************************************************/
